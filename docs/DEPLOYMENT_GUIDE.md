# دليل نشر تطبيق الأربعون النووية

## مقدمة

يوضح هذا الدليل كيفية نشر تطبيق "الأربعون النووية" على منصات استضافة سحابية مختلفة. تم تصميم التطبيق ليكون جاهزًا للنشر باستخدام Docker، مما يسهل عملية النشر على معظم الخدمات السحابية.

## المتطلبات الأساسية

قبل البدء، تأكد من توفر ما يلي:

1.  **حساب Supabase:** مع إعداد قاعدة البيانات كما هو موضح في ملف `SUPABASE_SETUP.md`.
2.  **ملفات المشروع:** بما في ذلك `Dockerfile`, `Procfile`, `runtime.txt`, `requirements.txt`, وجميع ملفات الكود.
3.  **حساب على منصة استضافة سحابية:** مثل Vercel, Netlify, Railway, Heroku, أو أي خدمة تدعم Docker.

## 1. إعداد المتغيرات البيئية (Environment Variables)

بغض النظر عن منصة النشر التي ستختارها، ستحتاج إلى تعيين المتغيرات البيئية التالية:

| المتغير البيئي    | الوصف                                                                | القيمة                                       |
| :---------------- | :------------------------------------------------------------------- | :------------------------------------------ |
| `SUPABASE_URL`    | رابط مشروع Supabase الخاص بك.                                        | `https://xxxxx.supabase.co`                 |
| `SUPABASE_KEY`    | مفتاح API العام (anon key) لمشروع Supabase الخاص بك.                | `your_anon_key_here`                        |
| `APP_NAME`        | اسم التطبيق (مثال: الأربعون النووية).                                | `الأربعون النووية`                           |
| `APP_VERSION`     | إصدار التطبيق (مثال: 2.0).                                           | `2.0`                                       |
| `DEBUG`           | وضع التصحيح (True/False). يفضل `False` في بيئة الإنتاج.             | `False`                                     |
| `RATE_LIMIT_PER_MINUTE` | عدد الطلبات المسموح بها لكل دقيقة لكل IP. (مثال: 100).             | `100`                                       |
| `ALLOWED_ORIGINS` | النطاقات المسموح لها بالوصول إلى API (مثال: `*, https://yourdomain.com`). | `*` (للسماح بالجميع، أو حدد نطاقات معينة) |

**ملاحظة:** لا تقم بتضمين هذه المتغيرات مباشرة في الكود الخاص بك. استخدم ملف `.env` محليًا، وقم بتعيينها في إعدادات منصة الاستضافة عند النشر.

## 2. النشر باستخدام Docker (الخيار الموصى به)

تم توفير `Dockerfile` في جذر المشروع، مما يجعل النشر عبر Docker سهلاً وفعالاً.

### محتويات `Dockerfile`:

```dockerfile
FROM python:3.11-slim-buster

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

هذا الملف يقوم بـ:
1.  استخدام صورة Python 3.11 الأساسية.
2.  تعيين دليل العمل إلى `/app`.
3.  نسخ `requirements.txt` وتثبيت جميع التبعيات.
4.  نسخ باقي ملفات المشروع.
5.  تعريض المنفذ 8000.
6.  تشغيل التطبيق باستخدام Uvicorn.

### خطوات النشر العامة (للمنصات التي تدعم Docker):

1.  **إنشاء مستودع Git:** قم بإنشاء مستودع Git جديد (مثل GitHub, GitLab, Bitbucket) وادفع جميع ملفات مشروعك إليه.
2.  **ربط منصة الاستضافة:** قم بربط مستودع Git الخاص بك بمنصة الاستضافة السحابية (مثل Railway, Render, Google Cloud Run).
3.  **تكوين النشر:**
    *   اختر النشر من Dockerfile.
    *   تأكد من تعيين المتغيرات البيئية المذكورة أعلاه في إعدادات المنصة.
    *   تأكد من أن المنصة تستمع على المنفذ 8000 (أو المنفذ الذي تحدده المنصة، وتأكد من أن `Procfile` أو `Dockerfile` يستخدم هذا المتغير).
4.  **النشر:** ابدأ عملية النشر. ستقوم المنصة ببناء صورة Docker وتشغيل التطبيق.

## 3. النشر على Heroku (باستخدام Procfile)

إذا كنت تفضل Heroku، يمكنك استخدام `Procfile` الذي تم توفيره:

### محتويات `Procfile`:

```
web: uvicorn main:app --host 0.0.0.0 --port $PORT
```

هذا الملف يخبر Heroku بكيفية تشغيل تطبيق الويب الخاص بك.

### خطوات النشر على Heroku:

1.  **إنشاء حساب Heroku:** إذا لم يكن لديك حساب، قم بإنشاء واحد على [heroku.com](https://www.heroku.com/).
2.  **تثبيت Heroku CLI:** اتبع التعليمات على موقع Heroku لتثبيت Heroku CLI.
3.  **تسجيل الدخول إلى Heroku:**
    ```bash
    heroku login
    ```
4.  **إنشاء تطبيق Heroku جديد:**
    ```bash
    heroku create your-app-name
    ```
    استبدل `your-app-name` باسم فريد لتطبيقك.
5.  **إضافة متغيرات البيئة:**
    ```bash
    heroku config:set SUPABASE_URL="https://xxxxx.supabase.co" SUPABASE_KEY="your_anon_key_here" APP_NAME="الأربعون النووية" APP_VERSION="2.0" DEBUG="False" RATE_LIMIT_PER_MINUTE="100" ALLOWED_ORIGINS="*"
    ```
    تأكد من استبدال القيم بقيمك الحقيقية.
6.  **دفع الكود إلى Heroku:**
    ```bash
    git push heroku main
    ```
    (إذا كان فرعك الرئيسي هو `master`، استخدم `git push heroku master`)
7.  **فتح التطبيق:**
    ```bash
    heroku open
    ```

## 4. النشر على Vercel أو Netlify (للمشاريع الثابتة أو التي تعتمد على API خارجي)

نظرًا لأن هذا المشروع يستخدم FastAPI (Python) كخلفية، فإن Vercel و Netlify ليسا الخيار الأمثل لاستضافة التطبيق بأكمله مباشرةً بنفس الطريقة التي يستضيفون بها تطبيقات الواجهة الأمامية (مثل React أو Vue). ومع ذلك، يمكنك استخدامهم لاستضافة الواجهة الأمامية إذا قمت بفصلها عن الواجهة الخلفية، أو إذا كنت تستخدم وظائف Serverless (مثل Vercel Functions) لتشغيل جزء من الـ API.

**الخيار الموصى به:** استخدم Vercel/Netlify لاستضافة الواجهة الأمامية (إذا كانت منفصلة)، واستخدم منصة تدعم Docker (مثل Railway, Render) للواجهة الخلفية.

### إذا كنت ترغب في نشر الواجهة الأمامية فقط (HTML/CSS/JS) على Vercel/Netlify:

1.  **إنشاء مستودع Git:** ضع ملفات HTML, CSS, JS في مستودع Git.
2.  **ربط Vercel/Netlify:** قم بربط مستودع Git الخاص بك بـ Vercel أو Netlify.
3.  **تكوين البناء:** عادةً ما تكتشف هذه المنصات تلقائيًا نوع المشروع.
4.  **النشر:** سيتم نشر موقعك الثابت.

**ملاحظة هامة:** في هذه الحالة، ستحتاج إلى استضافة الـ API (FastAPI) بشكل منفصل على منصة أخرى (مثل Railway أو Render) وتحديث `main.js` ليتصل بنقطة نهاية الـ API المستضافة بشكل دائم.

## 5. النشر على Railway

Railway هي منصة استضافة سحابية حديثة تدعم Docker بشكل ممتاز.

### خطوات النشر على Railway:

1.  **إنشاء حساب Railway:** إذا لم يكن لديك حساب، قم بإنشاء واحد على [railway.app](https://railway.app/).
2.  **ربط مستودع Git:** قم بربط حسابك على Railway بمستودع Git الخاص بالمشروع.
3.  **إنشاء مشروع جديد:**
    *   انقر على "New Project" ثم "Deploy from Git Repo".
    *   اختر المستودع الخاص بمشروعك.
4.  **تكوين النشر:**
    *   ستكتشف Railway تلقائيًا `Dockerfile` وستبدأ في بناء الصورة.
    *   انتقل إلى "Variables" في إعدادات المشروع وأضف جميع المتغيرات البيئية المذكورة في القسم 1.
    *   تأكد من أن Railway تقوم بتعيين المنفذ بشكل صحيح (عادةً ما يتم ذلك تلقائيًا، أو يمكنك تحديد `PORT` كمتغير بيئي).
5.  **النشر:** ستقوم Railway ببناء ونشر تطبيقك. يمكنك مراقبة السجلات من لوحة التحكم.

## المراجع

*   [توثيق Docker الرسمي](https://docs.docker.com/)
*   [توثيق Heroku Dev Center](https://devcenter.heroku.com/)
*   [توثيق Railway](https://docs.railway.app/)
*   [توثيق Vercel](https://vercel.com/docs)
*   [توثيق Netlify](https://docs.netlify.com/)
