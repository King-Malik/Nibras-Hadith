{% extends "base.html" %}

{% block title %}Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ - ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« | {{ settings.app_name }}{% endblock %}

{% block og_title %}Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ - {{ settings.app_name }}{% endblock %}
{% block og_description %}ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ÙˆØ­ÙØ¸ Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ† Ø§Ù„Ù†ÙˆÙˆÙŠØ© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©.{% endblock %}
{% block og_url %}{{ settings.site_url }}/profile{% endblock %}
{% block tw_title %}Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ - {{ settings.app_name }}{% endblock %}
{% block tw_description %}ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ÙˆØ­ÙØ¸ Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ† Ø§Ù„Ù†ÙˆÙˆÙŠØ©.{% endblock %}
{% block canonical %}{{ settings.site_url }}/profile{% endblock %}

{% block meta %}
{{ super() }}
<meta name="description" content="ØµÙØ­Ø© Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ Ù†Ø¨Ø±Ø§Ø³ - ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ÙˆØ­ÙØ¸ Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ† Ø§Ù„Ù†ÙˆÙˆÙŠØ© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ.">
<meta name="keywords" content="Ù…Ù„Ù Ø´Ø®ØµÙŠØŒ ØªÙ‚Ø¯Ù… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«ØŒ Ù†Ø¨Ø±Ø§Ø³">
<meta name="robots" content="noindex, follow">
{% endblock %}

{% block extra_css %}
<style>
    .profile-container {
        max-width: 900px;
        margin: 0 auto;
        padding: clamp(24px, 6vw, 48px) clamp(16px, 4vw, 24px);
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .profile-header {
        background: linear-gradient(135deg, var(--color-primary-soft) 0%, transparent 100%);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: clamp(24px, 6vw, 40px);
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 24px;
        flex-wrap: wrap;
        animation: fadeIn 0.5s ease-out;
    }

    .avatar-wrap {
        position: relative;
        flex-shrink: 0;
    }

    .avatar {
        width: clamp(72px, 15vw, 96px);
        height: clamp(72px, 15vw, 96px);
        border-radius: 50%;
        background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(28px, 7vw, 40px);
        color: white;
        font-weight: 700;
        box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        cursor: pointer;
        transition: transform 0.2s;
    }

    .avatar:hover { transform: scale(1.05); }

    .avatar-edit {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 26px;
        height: 26px;
        background: var(--color-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .avatar-edit .material-icons-outlined { font-size: 14px; color: white; }

    .profile-info { flex: 1; min-width: 200px; }

    .profile-name {
        font-size: clamp(20px, 5vw, 28px);
        font-weight: 700;
        color: var(--color-text-primary);
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }

    .profile-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        background: var(--color-primary-soft);
        color: var(--color-primary);
        font-size: 11px;
        font-weight: 600;
        padding: 2px 10px;
        border-radius: var(--radius-full);
        border: 1px solid rgba(16,185,129,0.3);
    }

    .profile-joined {
        font-size: 13px;
        color: var(--color-text-secondary);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .profile-stats {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .stat-item {
        text-align: center;
        min-width: 60px;
    }

    .stat-number {
        font-size: clamp(20px, 5vw, 26px);
        font-weight: 700;
        color: var(--color-primary);
        line-height: 1;
    }

    .stat-label {
        font-size: 11px;
        color: var(--color-text-secondary);
        margin-top: 3px;
    }

    /* â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tabs {
        display: flex;
        gap: 4px;
        background: var(--color-bg-hover);
        border-radius: var(--radius-md);
        padding: 4px;
        margin-bottom: 24px;
        overflow-x: auto;
    }

    .tab-btn {
        flex: 1;
        min-width: 100px;
        padding: 10px 16px;
        background: transparent;
        border: none;
        border-radius: calc(var(--radius-md) - 4px);
        color: var(--color-text-secondary);
        font-family: var(--font-family);
        font-size: clamp(12px, 2.5vw, 14px);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        white-space: nowrap;
    }

    .tab-btn.active {
        background: var(--color-bg-card);
        color: var(--color-primary);
        box-shadow: 0 2px 8px var(--color-shadow);
    }

    .tab-btn .material-icons-outlined { font-size: 18px; }

    /* â”€â”€ Tab Panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tab-panel { display: none; animation: fadeIn 0.3s ease-out; }
    .tab-panel.active { display: block; }

    /* â”€â”€ Saved Hadiths â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .saved-grid {
        display: grid;
        gap: 14px;
    }

    .saved-card {
        background: var(--color-bg-card);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        padding: clamp(16px, 4vw, 20px);
        display: flex;
        align-items: flex-start;
        gap: 16px;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s;
        position: relative;
    }

    .saved-card:hover {
        border-color: var(--color-primary);
        background: var(--color-bg-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 16px var(--color-shadow);
    }

    .saved-card-num {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--color-primary-soft);
        color: var(--color-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        font-weight: 700;
        flex-shrink: 0;
    }

    .saved-card-body { flex: 1; min-width: 0; }

    .saved-card-title {
        font-size: clamp(14px, 3vw, 16px);
        font-weight: 600;
        color: var(--color-text-primary);
        margin-bottom: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .saved-card-meta {
        font-size: 12px;
        color: var(--color-text-secondary);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .unsave-btn {
        background: none;
        border: none;
        cursor: pointer;
        color: var(--color-text-secondary);
        padding: 4px;
        border-radius: 6px;
        transition: all 0.2s;
        flex-shrink: 0;
    }

    .unsave-btn:hover { color: #ef4444; background: rgba(239,68,68,0.1); }
    .unsave-btn .material-icons-outlined { font-size: 18px; }

    .empty-state {
        text-align: center;
        padding: clamp(40px, 10vw, 64px) 24px;
        background: var(--color-bg-card);
        border: 1px dashed var(--color-border);
        border-radius: var(--radius-lg);
    }

    .empty-state .material-icons-outlined {
        font-size: 48px;
        color: var(--color-text-secondary);
        opacity: 0.4;
        margin-bottom: 12px;
        display: block;
    }

    .empty-state p {
        color: var(--color-text-secondary);
        margin-bottom: 16px;
        font-size: 15px;
    }

    .empty-state a {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 20px;
        background: var(--color-primary);
        color: white;
        border-radius: var(--radius-md);
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: background 0.2s;
    }

    .empty-state a:hover { background: var(--color-primary-dark); }

    /* â”€â”€ Activity / Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-section {
        background: var(--color-bg-card);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: clamp(20px, 5vw, 32px);
        margin-bottom: 16px;
    }

    .progress-title {
        font-size: 16px;
        font-weight: 700;
        color: var(--color-text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .progress-title .material-icons-outlined { color: var(--color-primary); font-size: 20px; }

    .progress-list { display: grid; gap: 14px; }

    .progress-item { display: flex; align-items: center; gap: 12px; }

    .progress-label {
        font-size: 13px;
        font-weight: 600;
        color: var(--color-text-primary);
        min-width: 110px;
        flex-shrink: 0;
    }

    .progress-bar-wrap {
        flex: 1;
        height: 8px;
        background: var(--color-bg-hover);
        border-radius: var(--radius-full);
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
        border-radius: var(--radius-full);
        transition: width 1s ease-out;
    }

    .progress-pct {
        font-size: 12px;
        font-weight: 700;
        color: var(--color-primary);
        min-width: 36px;
        text-align: left;
    }

    /* â”€â”€ Achievements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .achievements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
    }

    .achievement {
        background: var(--color-bg-card);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        padding: 16px 12px;
        text-align: center;
        transition: all 0.2s;
    }

    .achievement.earned {
        border-color: rgba(16,185,129,0.3);
        background: var(--color-primary-soft);
    }

    .achievement:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--color-shadow); }

    .achievement-icon {
        font-size: 32px;
        margin-bottom: 8px;
        filter: grayscale(1);
        opacity: 0.4;
    }

    .achievement.earned .achievement-icon { filter: none; opacity: 1; }

    .achievement-name {
        font-size: 12px;
        font-weight: 700;
        color: var(--color-text-primary);
        margin-bottom: 4px;
    }

    .achievement-desc {
        font-size: 11px;
        color: var(--color-text-secondary);
    }

    /* â”€â”€ Settings Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .settings-card {
        background: var(--color-bg-card);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        overflow: hidden;
        margin-bottom: 16px;
    }

    .settings-row {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        gap: 14px;
        border-bottom: 1px solid var(--color-border);
        transition: background 0.15s;
    }

    .settings-row:last-child { border-bottom: none; }
    .settings-row:hover { background: var(--color-bg-hover); }

    .settings-icon {
        width: 38px;
        height: 38px;
        border-radius: var(--radius-md);
        background: var(--color-primary-soft);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .settings-icon .material-icons-outlined { font-size: 18px; color: var(--color-primary); }

    .settings-text { flex: 1; }

    .settings-label {
        font-size: 14px;
        font-weight: 600;
        color: var(--color-text-primary);
    }

    .settings-sub {
        font-size: 12px;
        color: var(--color-text-secondary);
        margin-top: 2px;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .danger-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.2);
        border-radius: var(--radius-md);
        font-family: var(--font-family);
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .danger-btn:hover { background: rgba(239, 68, 68, 0.2); }

    /* â”€â”€ Login Prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .login-banner {
        background: linear-gradient(135deg, var(--color-primary-soft), transparent);
        border: 1px solid rgba(16,185,129,0.2);
        border-radius: var(--radius-lg);
        padding: clamp(20px, 5vw, 32px);
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
        animation: fadeIn 0.4s ease-out;
    }

    .login-banner .material-icons-outlined { font-size: 36px; color: var(--color-primary); flex-shrink: 0; }

    .login-banner-text { flex: 1; min-width: 200px; }
    .login-banner-text h3 { font-size: 16px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 4px; }
    .login-banner-text p { font-size: 13px; color: var(--color-text-secondary); }

    .login-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: var(--color-primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-family: var(--font-family);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        text-decoration: none;
        white-space: nowrap;
    }

    .login-btn:hover { background: var(--color-primary-dark); }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(16px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">

    <!-- Login Banner (ÙŠØ¸Ù‡Ø± Ù„Ù„Ø²ÙˆØ§Ø± ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†) -->
    <div class="login-banner" id="login-banner" style="display:none;">
        <span class="material-icons-outlined">lock_open</span>
        <div class="login-banner-text">
            <h3>Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø­ÙØ¸ ØªÙ‚Ø¯Ù…Ùƒ</h3>
            <p>Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø¯Ù… Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø£Ø¬Ù‡Ø²ØªÙƒ</p>
        </div>
        <a href="#" class="login-btn">
            <span class="material-icons-outlined">login</span>
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </a>
    </div>

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="avatar-wrap">
            <div class="avatar" id="profile-avatar">Ø£</div>
            <div class="avatar-edit" title="ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©">
                <span class="material-icons-outlined">edit</span>
            </div>
        </div>

        <div class="profile-info">
            <div class="profile-name">
                <span id="profile-name-text">Ø²Ø§Ø¦Ø±</span>
                <span class="profile-badge">
                    <span class="material-icons-outlined" style="font-size:12px">verified</span>
                    Ù‚Ø§Ø±Ø¦
                </span>
            </div>
            <div class="profile-joined">
                <span class="material-icons-outlined" style="font-size:15px">calendar_today</span>
                <span id="profile-joined">Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</span>
            </div>
            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-number" id="stat-saved">0</div>
                    <div class="stat-label">Ù…Ø­ÙÙˆØ¸</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="stat-read">0</div>
                    <div class="stat-label">Ù…Ù‚Ø±ÙˆØ¡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="stat-quiz">0</div>
                    <div class="stat-label">Ø§Ø®ØªØ¨Ø§Ø±</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="stat-streak">0</div>
                    <div class="stat-label">ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ ğŸ”¥</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist">
        <button class="tab-btn active" onclick="switchTab('saved', this)" role="tab">
            <span class="material-icons-outlined">bookmark</span>
            Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª
        </button>
        <button class="tab-btn" onclick="switchTab('progress', this)" role="tab">
            <span class="material-icons-outlined">trending_up</span>
            Ø§Ù„ØªÙ‚Ø¯Ù…
        </button>
        <button class="tab-btn" onclick="switchTab('achievements', this)" role="tab">
            <span class="material-icons-outlined">emoji_events</span>
            Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
        </button>
        <button class="tab-btn" onclick="switchTab('settings', this)" role="tab">
            <span class="material-icons-outlined">settings</span>
            Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </button>
    </div>

    <!-- Panel: Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª -->
    <div class="tab-panel active" id="panel-saved">
        <div class="saved-grid" id="saved-list"></div>
    </div>

    <!-- Panel: Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <div class="tab-panel" id="panel-progress">
        <div class="progress-section">
            <div class="progress-title">
                <span class="material-icons-outlined">auto_graph</span>
                ØªÙ‚Ø¯Ù… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
            </div>
            <div class="progress-list" id="progress-list">
                <div class="progress-item">
                    <span class="progress-label">Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©</span>
                    <div class="progress-bar-wrap">
                        <div class="progress-bar" id="bar-read" style="width:0%"></div>
                    </div>
                    <span class="progress-pct" id="pct-read">0%</span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</span>
                    <div class="progress-bar-wrap">
                        <div class="progress-bar" id="bar-saved" style="width:0%"></div>
                    </div>
                    <span class="progress-pct" id="pct-saved">0%</span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span>
                    <div class="progress-bar-wrap">
                        <div class="progress-bar" id="bar-quiz" style="width:0%;background:linear-gradient(90deg,#f59e0b,#fcd34d)"></div>
                    </div>
                    <span class="progress-pct" id="pct-quiz">0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel: Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª -->
    <div class="tab-panel" id="panel-achievements">
        <div class="achievements-grid" id="achievements-grid"></div>
    </div>

    <!-- Panel: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="tab-panel" id="panel-settings">
        <!-- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… -->
        <div class="settings-card">
            <div class="settings-row">
                <div class="settings-icon"><span class="material-icons-outlined">person</span></div>
                <div class="settings-text">
                    <div class="settings-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶</div>
                    <input type="text" id="name-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"
                        style="background:var(--color-bg-hover);border:1px solid var(--color-border);border-radius:8px;padding:6px 10px;font-family:var(--font-family);font-size:13px;color:var(--color-text-primary);width:100%;margin-top:6px;"
                        onchange="saveName(this.value)">
                </div>
            </div>
        </div>

        <!-- ØªØµØ¯ÙŠØ± / Ø§Ø³ØªÙŠØ±Ø§Ø¯ / Ù…Ø³Ø­ -->
        <div class="settings-card">
            <div class="settings-row">
                <div class="settings-icon"><span class="material-icons-outlined">download</span></div>
                <div class="settings-text">
                    <div class="settings-label">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    <div class="settings-sub">Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                </div>
                <button class="login-btn" onclick="exportData()" style="font-size:12px;padding:7px 14px;">
                    <span class="material-icons-outlined" style="font-size:15px">download</span>
                    ØªØµØ¯ÙŠØ±
                </button>
            </div>
            <div class="settings-row">
                <div class="settings-icon"><span class="material-icons-outlined">upload</span></div>
                <div class="settings-text">
                    <div class="settings-label">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    <div class="settings-sub">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù Ø³Ø§Ø¨Ù‚</div>
                </div>
                <button class="login-btn" onclick="document.getElementById('import-file').click()" style="font-size:12px;padding:7px 14px;">
                    <span class="material-icons-outlined" style="font-size:15px">upload</span>
                    Ø§Ø³ØªÙŠØ±Ø§Ø¯
                </button>
                <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
            </div>
            <div class="settings-row">
                <div class="settings-icon" style="background:rgba(239,68,68,0.1)">
                    <span class="material-icons-outlined" style="color:#ef4444">delete_forever</span>
                </div>
                <div class="settings-text">
                    <div class="settings-label" style="color:#ef4444">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    <div class="settings-sub">Ø­Ø°Ù Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                </div>
                <button class="danger-btn" onclick="clearAll()">
                    <span class="material-icons-outlined" style="font-size:15px">warning</span>
                    Ù…Ø³Ø­
                </button>
            </div>
        </div>
    </div>

</div>

<script>
const SAVED_KEY = 'hadith-saved';
const PREFS_KEY = 'hadith-prefs';
const TOTAL_HADITHS = 40;

// â”€â”€ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getPrefs() {
    try { return JSON.parse(localStorage.getItem(PREFS_KEY)) || {}; }
    catch { return {}; }
}

function savePrefs(prefs) {
    localStorage.setItem(PREFS_KEY, JSON.stringify(prefs));
}

function savePref(key, val) {
    const prefs = getPrefs();
    prefs[key] = val;
    savePrefs(prefs);
}

function getSaved() {
    try { return JSON.parse(localStorage.getItem(SAVED_KEY)) || []; }
    catch { return []; }
}

// â”€â”€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
    const prefs = getPrefs();
    const saved = getSaved();
    const name = prefs.name || 'Ø²Ø§Ø¦Ø±';

    // Header
    document.getElementById('profile-name-text').textContent = name;
    document.getElementById('profile-avatar').textContent = name.charAt(0) || 'Ø£';
    document.getElementById('profile-joined').textContent =
        prefs.joinedAt ? `Ø¹Ø¶Ùˆ Ù…Ù†Ø° ${new Date(prefs.joinedAt).toLocaleDateString('ar-SA', {year:'numeric',month:'long'})}` : 'Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯';

    if (!prefs.joinedAt) { prefs.joinedAt = Date.now(); savePrefs(prefs); }

    // Stats
    document.getElementById('stat-saved').textContent = saved.length;
    document.getElementById('stat-read').textContent = (prefs.readIds || []).length;
    document.getElementById('stat-quiz').textContent = prefs.quizScore || 0;
    document.getElementById('stat-streak').textContent = calcStreak(prefs);

    // Settings inputs
    document.getElementById('name-input').value = name;

    // Render
    renderSaved(saved);
    renderProgress(saved, prefs);
    renderAchievements(saved, prefs);
});

function calcStreak(prefs) {
    const days = prefs.activeDays || [];
    if (!days.length) return 0;
    days.sort((a, b) => b - a);
    let streak = 1;
    for (let i = 1; i < days.length; i++) {
        if (days[i - 1] - days[i] === 1) streak++;
        else break;
    }
    return streak;
}

// â”€â”€ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSaved(saved) {
    const container = document.getElementById('saved-list');
    if (!saved.length) {
        container.innerHTML = `
            <div class="empty-state">
                <span class="material-icons-outlined">bookmark_border</span>
                <p>Ù„Ù… ØªØ­ÙØ¸ Ø£ÙŠ Ø­Ø¯ÙŠØ« Ø¨Ø¹Ø¯</p>
                <a href="/"><span class="material-icons-outlined">explore</span> ØªØµÙØ­ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«</a>
            </div>`;
        return;
    }

    container.innerHTML = saved.map(h => `
        <a href="/hadith/${h.id}" class="saved-card">
            <div class="saved-card-num">${h.id}</div>
            <div class="saved-card-body">
                <div class="saved-card-title">${h.title}</div>
                <div class="saved-card-meta">
                    <span class="material-icons-outlined" style="font-size:13px">person</span>
                    ${h.narrator}
                    <span style="opacity:0.4">â€¢</span>
                    ${new Date(h.savedAt).toLocaleDateString('ar-SA', {month:'short',day:'numeric'})}
                </div>
            </div>
            <button class="unsave-btn" onclick="unsave(event, ${h.id})" title="Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª">
                <span class="material-icons-outlined">bookmark_remove</span>
            </button>
        </a>
    `).join('');
}

function unsave(e, id) {
    e.preventDefault();
    e.stopPropagation();
    let saved = getSaved().filter(h => h.id !== id);
    localStorage.setItem(SAVED_KEY, JSON.stringify(saved));
    document.getElementById('stat-saved').textContent = saved.length;
    renderSaved(saved);
    toastManager.show('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª', 'warning');
}

// â”€â”€ Ø§Ù„ØªÙ‚Ø¯Ù… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderProgress(saved, prefs) {
    const readCount = (prefs.readIds || []).length;
    const savedCount = saved.length;
    const quizScore = prefs.quizScore || 0;

    const setBar = (id, pctId, value, max) => {
        const pct = Math.round((value / max) * 100);
        document.getElementById(id).style.width = pct + '%';
        document.getElementById(pctId).textContent = `${value}/${max}`;
    };

    setTimeout(() => {
        setBar('bar-read', 'pct-read', readCount, TOTAL_HADITHS);
        setBar('bar-saved', 'pct-saved', savedCount, TOTAL_HADITHS);
        setBar('bar-quiz', 'pct-quiz', Math.min(quizScore, TOTAL_HADITHS), TOTAL_HADITHS);
    }, 200);
}

// â”€â”€ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ACHIEVEMENTS = [
    { id: 'first_save',   icon: 'ğŸ”–', name: 'Ø£ÙˆÙ„ Ø®Ø·ÙˆØ©',      desc: 'Ø§Ø­ÙØ¸ Ø­Ø¯ÙŠØ«Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹',       check: (s,p) => s.length >= 1 },
    { id: 'five_saved',   icon: 'ğŸ“š', name: 'Ù‚Ø§Ø±Ø¦ Ù†Ø´ÙŠØ·',     desc: 'Ø§Ø­ÙØ¸ 5 Ø£Ø­Ø§Ø¯ÙŠØ«',            check: (s,p) => s.length >= 5 },
    { id: 'all_saved',    icon: 'ğŸ†', name: 'Ø­Ø§ÙØ¸',          desc: 'Ø§Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«',        check: (s,p) => s.length >= 40 },
    { id: 'first_quiz',   icon: 'ğŸ¯', name: 'Ù…ØªØ¹Ù„Ù…',         desc: 'Ø£ÙƒÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹',      check: (s,p) => (p.quizScore||0) >= 1 },
    { id: 'quiz_perfect', icon: 'â­', name: 'Ù…ØªÙ…ÙŠØ²',         desc: 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 10 ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',   check: (s,p) => (p.quizScore||0) >= 10 },
    { id: 'streak_3',     icon: 'ğŸ”¥', name: '3 Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©', desc: 'Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ 3 Ø£ÙŠØ§Ù…',        check: (s,p) => calcStreak(p) >= 3 },
    { id: 'streak_7',     icon: 'ğŸ’', name: 'Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ§Ù…Ù„',    desc: 'Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ 7 Ø£ÙŠØ§Ù…',        check: (s,p) => calcStreak(p) >= 7 },
    { id: 'read_10',      icon: 'ğŸ“–', name: 'Ø¹Ø§Ø´Ø±',          desc: 'Ø§Ù‚Ø±Ø£ 10 Ø£Ø­Ø§Ø¯ÙŠØ«',            check: (s,p) => (p.readIds||[]).length >= 10 },
];

function renderAchievements(saved, prefs) {
    const grid = document.getElementById('achievements-grid');
    grid.innerHTML = ACHIEVEMENTS.map(a => {
        const earned = a.check(saved, prefs);
        return `
        <div class="achievement ${earned ? 'earned' : ''}">
            <div class="achievement-icon">${a.icon}</div>
            <div class="achievement-name">${a.name}</div>
            <div class="achievement-desc">${a.desc}</div>
        </div>`;
    }).join('');
}

// â”€â”€ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ§Ø¨Ø§Øª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(name, btn) {
    console.log('switchTab called:', name);
    console.log('Button:', btn);
    
    const tabs = document.querySelectorAll('.tab-btn');
    const panels = document.querySelectorAll('.tab-panel');
    const targetPanel = document.getElementById('panel-' + name);
    
    console.log('Tabs found:', tabs.length);
    console.log('Panels found:', panels.length);
    console.log('Target panel:', targetPanel);
    
    if (!targetPanel) {
        console.error('Panel not found: panel-' + name);
        return;
    }
    
    // Remove active from all tabs and panels
    tabs.forEach(b => b.classList.remove('active'));
    panels.forEach(p => p.classList.remove('active'));
    
    // Add active to clicked tab and corresponding panel
    btn.classList.add('active');
    targetPanel.classList.add('active');
    
    console.log('Tab switched successfully to:', name);
}

// â”€â”€ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveName(val) {
    const prefs = getPrefs();
    prefs.name = val.trim() || 'Ø²Ø§Ø¦Ø±';
    savePrefs(prefs);
    document.getElementById('profile-name-text').textContent = prefs.name;
    document.getElementById('profile-avatar').textContent = prefs.name.charAt(0);
    toastManager.show('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…', 'success');
}

// Toggle notifications
function toggleNotifications(checked) {
    if (checked) {
        if ('Notification' in window) {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    savePref('notifications', true);
                    toastManager.show('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', 'success');
                } else {
                    document.getElementById('notifications-toggle').checked = false;
                    toastManager.show('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', 'warning');
                }
            });
        } else {
            toastManager.show('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', 'error');
            document.getElementById('notifications-toggle').checked = false;
        }
    } else {
        savePref('notifications', false);
        toastManager.show('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', 'info');
    }
}

function exportData() {
    const prefs = getPrefs();
    const saved = getSaved();
    
    // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
    const allData = {
        version: '1.0',
        exportedAt: new Date().toISOString(),
        saved: saved,
        prefs: prefs,
        readIds: prefs.readIds || [],
        quizScores: prefs.quizScores || [],
        activeDays: prefs.activeDays || [],
        theme: localStorage.getItem('hadith-app-theme') || 'light',
        totalStats: {
            saved: saved.length,
            read: (prefs.readIds || []).length,
            quiz: prefs.quizScore || 0,
            streak: calcStreak(prefs)
        }
    };
    
    const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    const timestamp = new Date().toISOString().split('T')[0];
    a.download = `Ù†Ø¨Ø±Ø§Ø³-Ø¨ÙŠØ§Ù†Ø§Øª-${timestamp}.json`;
    a.click();
    toastManager.show('ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!data || typeof data !== 'object') {
                throw new Error('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­');
            }
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (data.saved) {
                localStorage.setItem(SAVED_KEY, JSON.stringify(data.saved));
            }
            
            if (data.prefs) {
                localStorage.setItem(PREFS_KEY, JSON.stringify(data.prefs));
            }
            
            if (data.theme) {
                localStorage.setItem('hadith-app-theme', data.theme);
                document.documentElement.classList.toggle('dark', data.theme === 'dark');
            }
            
            toastManager.show('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => location.reload(), 1500);
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            toastManager.show('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ù„Ù.', 'error');
        }
    };
    
    reader.readAsText(file);
    event.target.value = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† input
}

function clearAll() {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
    localStorage.removeItem(SAVED_KEY);
    localStorage.removeItem(PREFS_KEY);
    toastManager.show('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
    setTimeout(() => location.reload(), 1200);
}
</script>
{% endblock %}
